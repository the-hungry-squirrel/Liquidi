import React from 'react';
import { View, StyleSheet } from 'react-native';
import Svg, { Path, Ellipse, Rect, G } from 'react-native-svg';

interface AcornProps {
  size?: number;
}

// Single acorn component from SVG with highlights
const Acorn: React.FC<AcornProps> = ({ size = 120 }) => {
  return (
    <Svg width={size} height={size} viewBox="0 0 1024 1024">
      {/* Much lighter gray acorn body */}
      <Path
        fill="#e6e6e6"
        d="m 547.54011,850.23891 c -17.76664,-0.49131 -62.60788,-3.33737 -77,-4.88717 -19.25885,-2.07387 -42.35792,-5.72742 -65.5,-10.36005 -17.21554,-3.44624 -21.68393,-3.96244 -38.1418,-4.40626 -16.34007,-0.44064 -19.27717,-0.77604 -23.78768,-2.71641 -9.85428,-4.2392 -15.41106,-12.79709 -24.47585,-37.69482 -7.66607,-21.05594 -9.75133,-25.56429 -13.99899,-30.26595 -5.55982,-6.15405 -14.00541,-19.52437 -20.04078,-31.7268 -14.77621,-29.87483 -24.10679,-66.91562 -27.64539,-109.74742 -1.45599,-17.6235 -0.59506,-62.79518 1.4933,-78.35076 5.26257,-39.19943 17.0563,-83.48597 31.06427,-116.64924 6.73959,-15.95567 18.68835,-39.90977 23.94331,-48 2.50075,-3.85 4.55644,-7.57215 4.56821,-8.27144 0.0118,-0.69929 1.1773,-3.01812 2.59006,-5.15295 4.10842,-6.20824 5.48446,-12.11096 4.38632,-18.8157 -3.21935,-19.65576 1.55422,-43.56263 13.43003,-67.25991 31.14658,-62.15069 80.86476,-99.02485 145.11499,-107.62648 14.28745,-1.91276 42.82366,-2.15129 60,-0.50152 34.46322,3.31015 69.50905,12.19463 100.74082,25.53884 5.90745,2.52404 11.08245,4.57924 11.5,4.56711 0.41755,-0.0121 1.79178,-3.24856 3.05384,-7.19208 6.01979,-18.80974 20.63599,-42.30213 35.66388,-57.32195 22.88155,-22.86927 51.0581,-35.463924 79.33934,-35.463924 22.38013,0 46.16773,10.704064 62.87558,28.293064 9.8397,10.35864 12.0702,17.23338 8.7514,26.97333 -2.2941,6.73285 -8.3748,13.09133 -16.20647,16.94686 -6.20123,3.05285 -7.38946,3.28675 -16.69736,3.28675 -9.38363,0 -10.54717,-0.23427 -18.29292,-3.68318 -10.87491,-4.84222 -17.01186,-6.11808 -27.26474,-5.6683 -9.76088,0.42821 -17.80391,3.63897 -26.56086,10.60304 -11.80607,9.38893 -27.41958,36.5485 -27.39592,47.65499 0.0105,4.91088 2.9715,8.21626 15.16956,16.93365 16.06803,11.48309 27.51822,20.53999 40.82385,32.29097 62.1304,54.871 91.99996,111.80246 91.99996,175.352 0,39.12525 -10.8406,77.04976 -30.42278,106.43031 -13.8453,20.77309 -35.32189,39.25823 -54.26409,46.70571 l -8.00827,3.14861 -5.22545,11.6161 c -20.11787,44.72179 -54.12855,93.95519 -89.57937,129.67391 -24.12982,24.31216 -40.12121,36.57583 -72.70811,55.75928 l -3.70811,2.18291 61.70811,0.007 c 50.6227,0.005 65.21114,0.32089 81.20811,1.75599 40.28201,3.61373 61.24936,7.25371 71.8023,12.46506 5.0452,2.49146 5.73452,3.19603 6.01922,6.15243 0.64936,6.74315 -6.02271,10.33271 -27.11958,14.59027 -44.66513,9.01348 -160.43398,15.12296 -243.20194,12.83413 z M 311.75549,608.68403 c 3.72037,-4.05563 7.32681,-12.664 10.9203,-26.06613 3.7521,-13.99369 14.03564,-48.15422 17.51543,-58.18387 4.02825,-11.61047 16.71091,-45.17134 22.86296,-60.5 13.4545,-33.5237 15.64951,-42.35545 12.54637,-50.48091 -2.92447,-7.65763 -8.28015,-10.26675 -14.48645,-7.05735 -3.93203,2.03333 -14.30812,13.57688 -20.25884,22.53826 -6.53669,9.84381 -17.4912,32.40036 -23.2146,47.80145 -8.05713,21.6809 -15.42652,51.54958 -19.20697,77.84727 -2.39347,16.64953 -2.43364,38.10284 -0.0856,45.70475 3.00646,9.73345 8.83342,13.38266 13.40737,8.39653 z"
      />
      {/* Lighter gray acorn details */}
      <Path
        fill="#b3b3b3"
        d="m 528.54011,846.93172 c -53.82383,-2.65794 -93.95717,-7.69949 -132,-16.58183 -4.58412,-1.07032 -14.24765,-1.85932 -28,-2.28614 -20.7874,-0.64515 -21.05368,-0.68138 -26.30245,-3.57821 -5.13179,-2.83227 -10.11417,-8.41107 -13.44238,-15.05151 -0.82698,-1.65 -4.0888,-10.2 -7.24848,-19 -3.15968,-8.8 -6.56657,-17.62114 -7.57087,-19.60252 l -1.82599,-3.60253 13.19508,-0.55649 c 31.44651,-1.32625 72.58862,-13.69255 110.24699,-33.13752 67.93606,-35.07891 125.79325,-91.31561 177.3392,-172.3722 18.29953,-28.77622 40.68104,-69.99113 39.62658,-72.97122 -0.71849,-2.03059 -15.23838,-14.40263 -28.14173,-23.97887 -67.43977,-50.05055 -157.98233,-89.03661 -233.37595,-100.48764 -13.17729,-2.00141 -52.68428,-1.68508 -61.31205,0.49093 -3.74663,0.94493 -7.15854,1.71806 -7.58203,1.71806 -0.42349,0 0.76752,-3.0375 2.64667,-6.75 3.39756,-6.71228 3.41266,-6.80309 2.70234,-16.25 -1.9207,-25.54453 1.18753,-41.16768 13.03126,-65.5 4.89443,-10.05534 14.82638,-26.5 16.00501,-26.5 0.26934,0 -1.11496,2.8125 -3.07623,6.25 -7.56779,13.264 -8.91538,16.85677 -8.90823,23.75 0.008,7.71584 2.51034,12.60352 8.29367,16.19959 3.06705,1.9071 5.06739,2.29687 11.69959,2.27971 7.01805,-0.0182 8.75238,-0.41138 14.12968,-3.20365 3.37132,-1.75063 6.36094,-2.9517 6.64359,-2.66905 0.79031,0.79031 -1.82154,9.82509 -4.37607,15.13747 -2.93222,6.09783 -11.78867,14.94498 -19.15729,19.13719 -3.16805,1.80239 -5.54639,3.62284 -5.2852,4.04546 0.26119,0.42261 8.25323,1.0477 17.76009,1.38908 42.00961,1.50854 82.68387,11.2018 134.67973,32.09613 9.01699,3.62344 17.16296,6.58807 18.10217,6.58807 1.32612,0 1.95043,-1.46513 2.7943,-6.55776 0.59766,-3.60677 2.24922,-8.54152 3.67012,-10.96612 2.8456,-4.85563 8.85941,-10.01409 10.49566,-9.00283 0.57377,0.35461 1.04322,2.78081 1.04322,5.39156 0,7.09793 3.50435,16.29049 8.27728,21.71282 7.15741,8.13124 13.37714,9.19637 28.35535,4.85586 12.67515,-3.67312 33.48183,-13.84712 41.35266,-20.22053 l 2.3893,-1.93475 -3.69665,-5.03584 c -8.42062,-11.47119 -11.7242,-24.35249 -9.26739,-36.13541 1.58642,-7.6085 2.87109,-10.4935 7.50628,-16.857 3.82831,-5.25575 6.08317,-5.5728 6.08317,-0.85534 0,5.89873 3.71787,15.91574 7.58333,20.43166 6.90292,8.0645 18.04061,11.12005 28.21512,7.74062 18.26699,-6.06732 41.4532,-32.24678 46.55665,-52.56694 1.68232,-6.69845 1.39205,-7.59831 -2.90893,-9.01777 -4.11442,-1.35788 -12.80267,-9.00261 -16.0153,-14.09174 -3.87325,-6.13562 -6.45074,-15.3773 -7.11684,-25.51763 -0.60249,-9.17218 -0.73383,-9.58781 -3.71929,-11.77022 -1.70211,-1.24427 -6.69474,-3.76612 -11.09474,-5.60412 -4.4,-1.838 -8.34755,-3.63462 -8.77234,-3.99251 -1.26657,-1.06707 3.08113,-13.74503 8.75777,-25.5378 15.83107,-32.88782 39.55068,-56.47344 68.54373,-68.15655 32.24088,-12.991864 61.68362,-9.524324 88.51036,10.42405 13.52774,10.05923 19.39324,18.22038 19.43854,27.04641 0.044,8.63302 -5.0946,16.40236 -13.9822,21.1394 -11.30373,6.02483 -22.67208,5.92271 -36.9631,-0.33202 -10.76247,-4.71039 -16.90419,-5.94182 -26.61354,-5.33608 -6.93026,0.43237 -9.53656,1.12533 -15.71569,4.1785 -16.77357,8.28797 -32.36635,28.16208 -38.73786,49.37417 -2.0922,6.96537 -2.11843,7.5054 -0.56236,11.57991 1.95301,5.11389 4.03348,7.10009 17.09669,16.32209 50.64748,35.75468 88.71282,76.80648 109.25846,117.83042 14.1385,28.23075 20.3706,54.64003 20.4164,86.51702 0.058,40.53531 -10.7957,77.8409 -31.27312,107.48675 -13.59257,19.67845 -35.23487,37.51605 -53.40174,44.01377 -6.513,2.3295 -7.36167,3.05082 -9.27967,7.88733 -9.41032,23.72947 -35.68277,68.03184 -56.07451,94.55662 -33.3476,43.37726 -64.8195,71.77581 -105.29468,95.01225 -7.213,4.14091 -13.05319,7.96967 -12.97819,8.50834 0.0803,0.57695 4.34637,0.92273 10.3817,0.84148 56.56264,-0.7615 110.60501,-0.55243 124.74535,0.48259 48.45648,3.54683 75.19066,7.64083 86.04051,13.17601 4.54647,2.31943 5.29892,3.33452 4.45133,6.00505 -2.87216,9.04938 -56.9459,17.06397 -141.99184,21.04546 -29.37416,1.37518 -123.7082,1.97794 -145,0.92651 z M 755.84602,475.34357 c 4.01826,-1.96573 7.13144,-4.09954 6.91818,-4.7418 -0.21325,-0.64226 -2.6104,-1.44354 -5.327,-1.78063 -2.71659,-0.33709 -6.93773,-1.63244 -9.38029,-2.87854 -5.93194,-3.02625 -13.90766,-11.35589 -17.55293,-18.33185 -1.63013,-3.11958 -3.28981,-5.67304 -3.68819,-5.67434 -1.66643,-0.005 -3.94395,6.61672 -4.48171,13.0312 -0.74343,8.86758 0.99359,15.18732 5.37997,19.57369 6.47853,6.47854 15.97522,6.74936 28.13197,0.80227 z m 37.69409,-40.27688 c 4.39248,-2.00233 10.5,-6.78455 10.5,-8.22155 0,-0.50111 -2.74449,-0.91111 -6.09887,-0.91111 -8.15658,0 -11.78984,-1.91628 -19.21573,-10.1349 -3.40197,-3.76513 -6.48708,-6.85007 -6.85581,-6.8554 -0.36872,-0.005 -0.96806,2.8028 -1.33187,6.2403 -1.78315,16.84836 9.07316,26.23231 23.00228,19.88266 z m -136.85604,-7.73306 c 5.25584,-1.7844 12.35604,-5.96557 12.35604,-7.27622 0,-0.46834 -2.06578,-1.13468 -4.59062,-1.48075 -6.37344,-0.87357 -12.39451,-3.7324 -17.4387,-8.27996 -4.40637,-3.97253 -8.94362,-12.13099 -8.96091,-16.11267 -0.0138,-3.1754 -1.35282,-2.80009 -4.43713,1.24365 -9.68881,12.70268 -8.37838,27.06983 2.92736,32.09471 4.13148,1.83625 14.46464,1.73942 20.14396,-0.18876 z m 68.32785,-56.38522 c 4.23431,-2.16018 13.02819,-9.603 13.02819,-11.02659 0,-0.41662 -2.92398,-0.52278 -6.49772,-0.23591 -9.2379,0.74153 -13.78714,-1.26146 -22.28831,-9.81331 -3.79358,-3.81622 -7.38136,-6.93857 -7.97284,-6.93857 -1.22282,0 -3.26322,8.48723 -3.19724,13.29922 0.0564,4.11231 2.25195,10.2564 4.61103,12.9036 4.64242,5.20943 14.14458,5.98076 22.31689,1.81156 z m 40.88569,-30.87629 c 1.64792,-5.12117 0.81042,-12.10057 -1.84133,-15.34499 -3.10419,-3.79799 -4.51617,-1.10935 -4.51617,8.5995 0,11.85273 3.51422,15.58142 6.3575,6.74549 z M 528.74279,324.55683 c -17.68006,-6.60983 -25.04081,-24.72669 -17.78529,-43.77459 3.64113,-9.55905 10.40151,-18.00522 13.08436,-16.34713 0.54904,0.33933 1.00579,3.8529 1.015,7.80794 0.0136,5.83711 0.53587,8.22199 2.77397,12.66713 7.56014,15.01537 24.7846,19.11023 44.45928,10.56954 5.049,-2.19175 -1.36017,10.75115 -9.11634,18.40985 -3.09851,3.05958 -8.2515,6.82496 -11.45108,8.3675 -7.11408,3.42976 -17.24535,4.44367 -22.9799,2.29976 z m -98.3785,-1.06229 c -18.10925,-5.66242 -26.25167,-25.93342 -17.81717,-44.3568 3.07689,-6.72081 8.4776,-14.12996 10.33089,-14.17279 1.00937,-0.0233 1.17165,0.95308 0.66087,3.97635 -0.90726,5.37003 1.08906,16.62217 3.80949,21.47199 3.07584,5.48342 9.55151,10.12214 16.21109,11.61248 7.37219,1.64983 15.5673,0.13983 25.30563,-4.66273 4.02874,-1.98681 7.60382,-3.33354 7.94461,-2.99275 1.15863,1.15863 -4.79438,11.67593 -9.38931,16.58827 -10.79892,11.54492 -24.93331,16.32655 -37.0561,12.53598 z m 183.17582,-57.43285 c -14.75531,-3.90068 -24.04846,-17.94969 -20.52614,-31.0306 0.64901,-2.41023 2.9454,-8.09805 5.10308,-12.63959 4.61924,-9.72267 4.88605,-13.15957 1.34801,-17.36429 -3.66474,-4.3553 -10.43097,-6.09318 -23.72308,-6.09318 -10.86457,0 -10.93097,-0.0145 -10.29018,-2.25 4.195,-14.63481 4.30301,-19.76195 0.45963,-21.81887 -3.75557,-2.00992 -1.25106,-1.98454 9.73076,0.0986 18.06851,3.42741 39.89837,9.71058 57.89792,16.66443 11.08754,4.28351 12.31086,5.30584 6.34894,5.30584 -5.0361,0 -12.47435,3.3926 -17.15467,7.82428 -1.54314,1.46118 -4.24314,5.5765 -6,9.14517 -2.73408,5.55371 -3.19427,7.57203 -3.19427,14.00952 0,6.42143 0.40594,8.21161 2.77658,12.24445 5.48053,9.3233 17.06156,12.8767 30.29357,9.29496 3.58456,-0.97029 6.80806,-1.4735 7.16333,-1.11823 1.42939,1.42939 -9.45991,10.84102 -16.45429,14.22145 -7.64297,3.6939 -17.54557,5.15396 -23.77919,3.50606 z M 508.33018,241.94854 c -9.78818,-4.93444 -14.72276,-12.29343 -15.91922,-23.74048 -0.81217,-7.77047 1.23016,-14.70501 8.40461,-28.53701 l 5.58259,-10.76298 -1.63018,-3.41851 c -1.33012,-2.7893 -2.42142,-3.58571 -5.92902,-4.3269 l -4.29885,-0.90838 5.99105,-0.80547 c 7.76391,-1.04381 37.47445,0.0507 38.85515,1.43142 0.7384,0.7384 0.29349,1.0538 -1.48648,1.0538 -4.27906,0 -14.52705,5.81516 -18.7973,10.66643 -5.21917,5.92929 -8.26386,14.05008 -8.29116,22.11417 -0.0284,8.39504 3.5634,14.48637 10.71097,18.16464 6.893,3.54726 18.42372,3.62213 26.80371,0.17403 3.18226,-1.3094 6.06161,-2.10505 6.39855,-1.76811 0.95548,0.95548 -4.36134,8.055 -10.03744,13.40292 -7.34142,6.91695 -13.47411,9.63919 -22.64705,10.05281 -6.77429,0.30547 -8.10088,0.0353 -13.70993,-2.79238 z m -92.72578,0.85951 c -3.77056,-0.88133 -9.6037,-4.57408 -12.3737,-7.83333 -2.54762,-2.99759 -6.061,-11.62122 -7.24815,-17.79069 -0.66146,-3.4375 -1.5941,-6.25 -2.07255,-6.25 -0.47844,0 -0.86989,-0.40627 -0.86989,-0.90283 0,-1.28288 16.19982,-12.70706 23.96799,-16.90232 l 6.53201,-3.52766 -2.63998,2.91641 c -9.76865,10.79149 -9.19461,26.46256 1.15991,31.66485 5.80357,2.91581 15.003,2.35885 23.16306,-1.40237 3.76338,-1.73465 7.11087,-2.88556 7.43885,-2.55757 1.91548,1.91548 -13.12723,16.38171 -20.82425,20.0262 -6.44419,3.05129 -11.0332,3.77478 -16.2333,2.55931 z"
      />
      {/* White highlight on body */}
      <Path
        fill="#ffffff"
        d="m 274.74963,610.72459 c 15.05456,74.90772 23.0245,93.27455 43.18051,120.51474 17.0612,12.56879 35.31694,-1.47015 52.89965,-5.64539 29.29634,-8.1106 101.63445,-40.50504 135.14168,-77.78522 43.33216,-48.98846 81.78479,-119.84879 61.72529,-168.05895 -8.2512,-28.72958 -77.41943,-60.92592 -115.03468,-76.45816 -83.1529,-19.99614 -108.89174,-27.64476 -131.04379,-2.1275 -32.07049,37.6159 -55.92853,152.34746 -46.86866,209.56048 z"
      />
      {/* White highlight dots */}
      <Ellipse fill="#ffffff" cx={450.51877} cy={270.68307} rx={32.455368} ry={33.780079} />
      <Ellipse fill="#ffffff" cx={549.83441} cy={271.45535} rx={27.156532} ry={25.831827} />
      <Ellipse fill="#ffffff" cx={365.71411} cy={278.37646} rx={19.208279} ry={19.870636} />
      <Ellipse fill="#ffffff" cx={437.01553} cy={206.88228} rx={19.208279} ry={19.870636} />
      <Rect fill="#ffffff" x={353.6973} y={274.21475} width={10.597672} height={2.6494179} />
    </Svg>
  );
};

interface AcornStackProps {
  amount: number; // Amount in euros
  maxAcorns?: number; // Maximum number of acorns across all three sections (for uniform scaling)
}

// Empty acorn component (filled design for negative/zero amounts)
const EmptyAcorn: React.FC<AcornProps> = ({ size = 120 }) => {
  const mainColor = '#b3b3b3'; // Medium gray for empty acorn
  const lighterColor = '#e6e6e6'; // Light gray for highlights

  return (
    <Svg width={size} height={size} viewBox="0 0 1024 1024">
      <G>
        <Path
          id="path16-1"
          fill={mainColor}
          fillOpacity={1}
          stroke={mainColor}
          strokeWidth={14.6053}
          d="m 419.99197,428.49734 c 40.29041,-68.31461 77.09777,-150.43803 146.8778,-187.9111 37.91709,-19.9245 18.97542,118.97291 18.91713,68.2208 -37.19281,135.07579 -100.24608,267.71836 -198.19869,360.07594 -15.30164,21.10888 -46.12058,8.04295 -41.72965,-18.27479 4.04494,-80.30008 41.19617,-153.38375 74.13341,-222.11085 z M 615.26834,682.1733 c -14.77325,31.72221 -74.19153,-15.35366 -34.43245,-24.82602 13.3573,-1.96537 38.01287,5.56925 34.43245,24.82602 z m -46.25851,-79.38667 c -15.10143,37.70198 -88.36559,-7.23336 -52.32823,-32.93972 19.35296,-9.73503 57.5827,4.17448 52.32823,32.93972 z M 683,289.5 c -4.56423,42.46894 -66.57565,1.00168 -30.11155,-16.66792 11.21801,-5.15767 29.5336,0.66264 30.11155,16.66792 z m -78.39473,470.75605 c 69.50947,-1.56483 189.01669,-2.58576 242.21834,23.53149 -0.70342,22.6464 -174.07116,33.20755 -325.12136,19.00509 -34.39973,-7.58703 -39.70995,-19.43101 -19.17199,-20.78807 53.90061,-13.51948 46.54687,-19.86153 102.07501,-21.74851 z M 410.93442,436.11912 c 42.38963,-68.13795 81.444,-158.18278 158.32312,-184.87158 41.22149,14.196 12.88161,81.94661 8.20861,110.49506 -45.42008,122.57449 -101.40546,261.64938 -212.20266,326.49473 -48.65201,-1.68208 -19.00938,-84.05283 -13.72966,-109.97995 14.83896,-49.82212 35.76092,-96.98874 59.40059,-142.13826 z m -38.31014,234.04419 c 84.47619,-47.47418 137.92515,-138.60677 174.12808,-231.70459 16.3913,-45.33064 31.73329,-92.08492 37.02029,-141.1667 6.98677,-20.88881 -16.89397,-49.47404 -5.83334,-64.09932 35.27158,1.61223 67.20391,23.48037 99.16557,38.99898 19.19769,11.12529 10.36563,8.34484 -4.07962,-0.12159 -24.08097,-14.43894 -40.47896,17.93341 -24.83059,38.00449 -17.27346,6.68035 -34.37562,-31.36907 -39.04512,-23.40564 0.0129,58.49486 -18.67531,113.07989 -39.34828,165.12907 11.96914,0.79111 41.63176,20.1847 12.57558,19.36379 -36.70715,8.62916 -13.27489,55.51046 2.21142,76.6248 15.18413,-2.73939 40.99512,-22.4605 59.963,-3.06846 9.82465,12.01201 -33.02518,7.36423 -28.47924,30.30307 0.98257,29.42143 30.21787,49.77958 53.72924,58.1352 16.81114,-4.48725 29.50907,-32.67434 54.02885,-26.45656 13.87474,-4.64722 12.41451,-35.42028 32.68765,-18.35445 45.42519,17.2904 89.41953,63.68864 84.11242,118.77056 -4.74709,26.79658 -23.2478,68.12668 -53.84447,59.6021 -28.84201,-15.85156 -9.2272,-48.65893 -6.10007,-72.00778 -1.11173,-32.90903 -33.92973,-53.68057 -60.5645,-59.59258 -27.45537,13.32198 -38.66157,50.44 -63.20589,69.59356 -46.7646,50.50963 -111.76983,85.54872 -180.917,77.49781 -53.55075,-3.92627 -113.7784,-32.01432 -135.75658,-90.27072 -19.60808,-8.5611 30.34334,-15.87129 32.3826,-21.77504 z m 93.76745,10.4439 c 9.04422,16.2732 11.07757,-26.17943 27.73282,-25.34203 12.92915,-14.972 -45.43592,-10.14162 -31.02744,16.72883 l 1.3559,4.17982 z M 617.17847,453.50399 c 8.75405,-25.89399 44.80291,-26.51221 60.28743,-5.88408 -23.6787,-2.20796 -45.97975,24.2212 -31.05797,50.80742 -17.4393,-2.62819 -35.1317,-25.44338 -29.22946,-44.92334 z m 1.06229,-98.3785 c 7.81033,-25.69452 42.71357,-27.37999 58.52959,-7.48628 -27.10584,-6.30878 -49.83362,25.13797 -30.02886,51.34237 -11.31998,5.75292 -36.76838,-26.30979 -28.50073,-43.85609 z m 57.43285,183.17582 c 8.2734,-35.41313 41.04293,-11.49272 61.03448,-14.07505 12.02245,-12.47147 -3.29696,-46.10967 23.96932,-30.76905 17.65235,-10.25337 -2.31517,32.18402 -3.14539,43.37904 -5.09308,13.27882 -11.76457,47.23704 -17.46287,14.60606 -17.38883,-27.54286 -62.28329,-8.72552 -46.73006,24.72179 -8.30349,3.5764 -22.34227,-27.17932 -17.66548,-37.86279 z m 24.11315,-105.20993 c 11.15366,-23.35307 40.01205,-16.94973 57.83555,-4.63173 13.19561,8.79898 15.72621,-22.73687 15.07504,5.98507 -0.0988,16.0812 0.42788,44.47523 -9.84924,13.55586 -25.24038,-33.43582 -58.0915,5.13111 -44.14325,31.11816 -14.92168,-8.44752 -28.24905,-28.67482 -18.9181,-46.02736 z m -0.85951,-92.72578 c 9.94504,-25.5145 43.5255,-29.08686 50.46063,2.85069 7.77735,11.37038 -27.86579,-18.85707 -31.83506,3.60495 -6.66109,12.72257 13.24895,45.06445 -8.63332,20.25412 -6.25956,-7.00494 -12.43808,-16.77027 -9.99225,-26.70976 z M 540.07337,246.6421 c 15.85287,-19.265 32.74968,-8.49319 48.87394,2.87349 27.86663,-2.65015 56.9952,1.43207 82.60645,16.64501 57.28415,27.91605 102.29532,90.36338 103.17018,158.92812 3.02764,54.42698 -9.93343,107.64124 -30.90062,155.45341 47.17848,15.24398 96.24664,55.68699 99.83091,112.75682 1.33099,32.74555 -16.81285,67.28181 -45.03586,78.21114 -33.23049,0.76796 -36.34138,-44.12526 -21.81534,-66.34634 7.2312,-28.69794 -17.13199,-52.21254 -39.92482,-61.81096 -24.9365,-18.09185 -36.69856,15.77488 -50.46217,31.07249 -47.44704,60.90003 -113.39743,112.69431 -191.59794,111.37599 -56.57247,-0.0486 -121.81883,-22.82022 -151.6124,-81.10799 -16.22574,-38.06955 -3.99279,-80.66262 5.25205,-117.75137 33.44463,-113.10635 87.88501,-218.43293 160.08593,-306.19309 10.04021,-11.86793 20.52614,-23.29244 31.52969,-34.10672 z"
        />
        <Ellipse
          fill={lighterColor}
          fillOpacity={1}
          stroke={mainColor}
          strokeWidth={16.0504}
          strokeOpacity={1}
          cx="634.67303"
          cy="194.79836"
          rx="111.0873"
          ry="263.03006"
          transform="matrix(0.88148327,0.47221525,-0.43611068,0.89989304,0,0)"
        />
      </G>
    </Svg>
  );
};

// Hilfsfunktion zum Anpassen der Helligkeit
function adjustColorBrightness(color: string, percent: number): string {
  const num = parseInt(color.replace('#', ''), 16);
  const amt = Math.round(2.55 * percent);
  const R = Math.min(255, Math.max(0, (num >> 16) + amt));
  const G = Math.min(255, Math.max(0, ((num >> 8) & 0x00FF) + amt));
  const B = Math.min(255, Math.max(0, (num & 0x0000FF) + amt));
  return '#' + (0x1000000 + (R << 16) + (G << 8) + B).toString(16).slice(1);
}

export const AcornStack: React.FC<AcornStackProps> = ({ amount, maxAcorns }) => {
  // Calculate number of acorns (1 acorn = 500€)
  const totalAcorns = Math.floor(Math.abs(amount) / 500);

  // Use maxAcorns if provided, otherwise use totalAcorns for scaling decision
  const acornsForScaling = maxAcorns !== undefined ? maxAcorns : Math.max(totalAcorns, 1);

  // Scale down acorns if there are 10 or more in ANY section
  // Base size is 120, but reduce to 60 (50% smaller) if we have 10 or more acorns
  let acornSize = 120;
  let horizontalSpacing = 70;

  if (acornsForScaling >= 10) {
    acornSize = 60; // 50% of 120
    horizontalSpacing = 35; // 50% of 70
  }

  // Calculate the maximum width available (roughly 1/3 of screen minus padding)
  const maxWidth = 300; // Conservative estimate for column width

  // Calculate actual width needed based on maxAcorns for uniform scaling
  const widthForMaxAcorns = acornSize + (acornsForScaling - 1) * (acornSize - horizontalSpacing);

  // If width exceeds maximum, scale down further or increase overlap
  let finalSize = acornSize;
  let finalSpacing = horizontalSpacing;

  if (widthForMaxAcorns > maxWidth) {
    // Calculate scale factor to fit within bounds based on maxAcorns
    const scaleFactor = maxWidth / widthForMaxAcorns;
    finalSize = Math.floor(acornSize * scaleFactor);
    finalSpacing = Math.floor(horizontalSpacing * scaleFactor);
  }

  // Show empty acorn for zero, negative amounts, or positive amounts less than 500€
  if (amount < 500) {
    return (
      <View style={styles.container}>
        <View style={styles.acornsContainer}>
          <EmptyAcorn size={finalSize} />
        </View>
      </View>
    );
  }

  return (
    <View style={styles.container}>
      <View style={styles.acornsContainer}>
        {[...Array(totalAcorns)].map((_, index) => (
          <View
            key={`acorn-${index}`}
            style={[
              styles.acornWrapper,
              {
                marginLeft: index === 0 ? 0 : -finalSpacing,
                zIndex: totalAcorns - index // Stack from back to front
              }
            ]}
          >
            <Acorn size={finalSize} />
          </View>
        ))}
      </View>
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    alignItems: 'center',
    justifyContent: 'center',
    paddingVertical: 12,
    minHeight: 100
  },
  acornsContainer: {
    flexDirection: 'row',
    alignItems: 'center',
    justifyContent: 'center'
  },
  acornWrapper: {
    // Acorns overlap horizontally
  }
});
